/**
 * Icon utilities: maps icon names (PascalCase) to Lucide icons.
 * Use in subview spec: { "icon": "ChartPie" } or layout: { icon: { name: "Wallet", color: "#22c55e" } }
 */
import {
  LayoutDashboard,
  ChartPie,
  Wallet,
  TrendingUp,
  BarChart3,
  PieChart,
  LineChart,
  DollarSign,
  Percent,
  Activity,
  Target,
  BarChart2,
  PiggyBank,
  Landmark,
  ArrowUpRight,
  ArrowDownRight,
  ArrowUp,
  ArrowDown,
  ArrowLeft,
  ArrowRight,
  Minus,
  Plus,
  Settings,
  RefreshCw,
  Download,
  Upload,
  FileText,
  Table,
  List,
  Grid,
  Calendar,
  Clock,
  Info,
  HelpCircle,
  Star,
  Heart,
  Bell,
  CheckCircle,
  XCircle,
  AlertCircle,
  ChevronRight,
  ChevronDown,
  ChevronUp,
  ChevronLeft,
  Search,
  Filter,
  MoreHorizontal,
  Pencil,
  Trash2,
  Copy,
  Eye,
  EyeOff,
  Lock,
  Unlock,
  User,
  Users,
  Folder,
  FolderOpen,
  Home,
  Building2,
  Car,
  Plane,
  Ship,
  Bike,
  Bus,
  Truck,
  Camera,
  Image,
  ImagePlus,
  Video,
  Music,
  Book,
  BookOpen,
  File,
  FilePlus,
  Mail,
  Phone,
  MessageSquare,
  Send,
  Share2,
  Link,
  ExternalLink,
  Gift,
  Package,
  ShoppingCart,
  ShoppingBag,
  CreditCard,
  Banknote,
  Coins,
  Scale,
  Zap,
  Battery,
  BatteryCharging,
  Wifi,
  Bluetooth,
  Tv,
  Monitor,
  Laptop,
  Smartphone,
  Tablet,
  Cpu,
  HardDrive,
  Database,
  Server,
  Cloud,
  CloudUpload,
  CloudDownload,
  Sun,
  Moon,
  CloudRain,
  Snowflake,
  Thermometer,
  Droplet,
  Wind,
  Flame,
  Sparkles,
  Award,
  Trophy,
  Medal,
  Crown,
  Flag,
  Bookmark,
  Tag,
  Hash,
  AtSign,
  Volume2,
  VolumeX,
  Headphones,
  Mic,
  Play,
  Pause,
  SkipBack,
  SkipForward,
  Repeat,
  Shuffle,
  Compass,
  Map,
  MapPin,
  Globe,
  GlobeLock,
  Shield,
  ShieldCheck,
  ShieldAlert,
  Key,
  KeyRound,
  Scan,
  QrCode,
  Clipboard,
  ClipboardCheck,
  Scissors,
  Ruler,
  Paintbrush,
  Palette,
  Brush,
  Pen,
  Highlighter,
  Eraser,
  AArrowDown,
  AArrowUp,
  ALargeSmall,
  Accessibility,
  ActivitySquare,
  AirVent,
  Airplay,
  AlarmCheck,
  AlarmClock,
  AlarmClockCheck,
  AlarmClockMinus,
  AlarmClockOff,
  AlarmClockPlus,
  AlarmMinus,
  AlarmPlus,
  AlarmSmoke,
  Album,
  AlertOctagon,
  AlertTriangle,
  AlignCenter,
  AlignCenterHorizontal,
  AlignCenterVertical,
  AlignEndHorizontal,
  AlignEndVertical,
  AlignHorizontalDistributeCenter,
  AlignHorizontalDistributeEnd,
  AlignHorizontalDistributeStart,
  AlignHorizontalJustifyCenter,
  AlignHorizontalJustifyEnd,
  AlignHorizontalJustifyStart,
  AlignHorizontalSpaceAround,
  AlignHorizontalSpaceBetween,
  AlignJustify,
  AlignLeft,
  AlignRight,
  AlignStartHorizontal,
  AlignStartVertical,
  AlignVerticalDistributeCenter,
  AlignVerticalDistributeEnd,
  AlignVerticalDistributeStart,
  AlignVerticalJustifyCenter,
  AlignVerticalJustifyEnd,
  AlignVerticalJustifyStart,
  AlignVerticalSpaceAround,
  AlignVerticalSpaceBetween,
  Ambulance,
  Ampersand,
  Ampersands,
  Amphora,
  Anchor,
  Angry,
  Annoyed,
  Antenna,
  Anvil,
  Aperture,
  AppWindow,
  AppWindowMac,
  Apple,
  Archive,
  ArchiveRestore,
  ArchiveX,
  AreaChart,
  Armchair,
  ArrowBigDown,
  ArrowBigDownDash,
  ArrowBigLeft,
  ArrowBigLeftDash,
  ArrowBigRight,
  ArrowBigRightDash,
  ArrowBigUp,
  ArrowBigUpDash,
  ArrowDown01,
  ArrowDown10,
  ArrowDownAZ,
  ArrowDownAz,
  ArrowDownCircle,
  ArrowDownFromLine,
  ArrowDownLeft,
  ArrowDownLeftFromCircle,
  ArrowDownLeftFromSquare,
  ArrowDownLeftSquare,
  ArrowDownNarrowWide,
  ArrowDownRightFromCircle,
  ArrowDownRightFromSquare,
  ArrowDownRightSquare,
  ArrowDownSquare,
  ArrowDownToDot,
  ArrowDownToLine,
  ArrowDownUp,
  ArrowDownWideNarrow,
  ArrowDownZA,
  ArrowDownZa,
  ArrowLeftCircle,
  ArrowLeftFromLine,
  ArrowLeftRight,
  ArrowLeftSquare,
  ArrowLeftToLine,
  ArrowRightCircle,
  ArrowRightFromLine,
  ArrowRightLeft,
  ArrowRightSquare,
  ArrowRightToLine,
  ArrowUp01,
  ArrowUp10,
  ArrowUpAZ,
  ArrowUpAz,
  ArrowUpCircle,
  ArrowUpDown,
  ArrowUpFromDot,
  ArrowUpFromLine,
  ArrowUpLeft,
  ArrowUpLeftFromCircle,
  ArrowUpLeftFromSquare,
  ArrowUpLeftSquare,
  ArrowUpNarrowWide,
  ArrowUpRightFromCircle,
  ArrowUpRightFromSquare,
  ArrowUpRightSquare,
  ArrowUpSquare,
  ArrowUpToLine,
  ArrowUpWideNarrow,
  ArrowUpZA,
  ArrowUpZa,
  ArrowsUpFromLine,
  Asterisk,
  AsteriskSquare,
  Atom,
  AudioLines,
  AudioWaveform,
  Axe,
  Axis3D,
  Baby,
  Backpack,
  Badge,
  BadgeAlert,
  BadgeCent,
  BadgeCheck,
  BadgeDollarSign,
  BadgeEuro,
  BadgeHelp,
  BadgeIndianRupee,
  BadgeInfo,
  Receipt,
  ReceiptText,
  BanknoteArrowDown,
  BanknoteArrowUp,
  CandlestickChart,
  ChartArea,
  ChartBar,
  ChartBarIncreasing,
  ChartBarDecreasing,
  TrendingDown,
  Euro,
  PoundSterling,
  JapaneseYen,
  RussianRuble,
  SwissFranc,
  TurkishLira,
  IndianRupee,
  PhilippinePeso,
  CircleDollarSign,
  HandCoins,
  Wallet2,
  WalletCards,
  HouseHeart,
  Flower2,
  Flower,
  Sprout,
  Trees,
  TreePine,
  TreePalm,
  Palmtree,
  Hospital,
  Bed,
  BedDouble,
  Utensils,
  UtensilsCrossed,
  Coffee,
  Wine,
  WineOff,
  Beer,
  Cake,
  CakeSlice,
  Egg,
  EggFried,
  Carrot,
  Salad,
  Soup,
  Milk,
  Pizza,
  BottleWine,
  Bird,
  Cat,
  Dog,
  Fish,
  FishOff,
  Bug,
  PawPrint,
  Rabbit,
  Snail,
  Squirrel,
  Turtle,
  Worm,
  Beef,
  Bone,
  Feather,
  Microchip,
  Code2,
  CodeSquare,
  Terminal,
  TerminalSquare,
  DatabaseBackup,
  ServerCog,
  ServerOff,
  CloudCheck,
  WifiCog,
  BluetoothConnected,
  BluetoothOff,
  Usb,
  MonitorCheck,
  Laptop2,
  SmartphoneCharging,
  Cable,
  Plug,
  PlugZap,
  CircuitBoard,
  Binary,
  Bot,
  ScanBarcode,
  ScanText,
  Radar,
  Satellite,
  SatelliteDish,
  Microscope,
  Dumbbell,
  Footprints,
  Timer,
  TimerOff,
  TimerReset,
  Volleyball,
  type LucideIcon,
} from 'lucide-react';

/** Map icon name (PascalCase) to Lucide component. Used for spec.icon and layout icon content. */
export const ICON_MAP: Record<string, LucideIcon> = {
  LayoutDashboard,
  ChartPie,
  Wallet,
  TrendingUp,
  BarChart3,
  PieChart,
  LineChart,
  DollarSign,
  Percent,
  Activity,
  Target,
  BarChart2,
  PiggyBank,
  Landmark,
  ArrowUpRight,
  ArrowDownRight,
  ArrowUp,
  ArrowDown,
  ArrowLeft,
  ArrowRight,
  Minus,
  Plus,
  Settings,
  RefreshCw,
  Download,
  Upload,
  FileText,
  Table,
  List,
  Grid,
  Calendar,
  Clock,
  Info,
  HelpCircle,
  Star,
  Heart,
  Bell,
  CheckCircle,
  XCircle,
  AlertCircle,
  ChevronRight,
  ChevronDown,
  ChevronUp,
  ChevronLeft,
  Search,
  Filter,
  MoreHorizontal,
  Pencil,
  Trash2,
  Copy,
  Eye,
  EyeOff,
  Lock,
  Unlock,
  User,
  Users,
  Folder,
  FolderOpen,
  Home,
  Building2,
  Car,
  Plane,
  Ship,
  Bike,
  Bus,
  Truck,
  Camera,
  Image,
  ImagePlus,
  Video,
  Music,
  Book,
  BookOpen,
  File,
  FilePlus,
  Mail,
  Phone,
  MessageSquare,
  Send,
  Share2,
  Link,
  ExternalLink,
  Gift,
  Package,
  ShoppingCart,
  ShoppingBag,
  CreditCard,
  Banknote,
  Coins,
  Scale,
  Zap,
  Battery,
  BatteryCharging,
  Wifi,
  Bluetooth,
  Tv,
  Monitor,
  Laptop,
  Smartphone,
  Tablet,
  Cpu,
  HardDrive,
  Database,
  Server,
  Cloud,
  CloudUpload,
  CloudDownload,
  Sun,
  Moon,
  CloudRain,
  Snowflake,
  Thermometer,
  Droplet,
  Wind,
  Flame,
  Sparkles,
  Award,
  Trophy,
  Medal,
  Crown,
  Flag,
  Bookmark,
  Tag,
  Hash,
  AtSign,
  Volume2,
  VolumeX,
  Headphones,
  Mic,
  Play,
  Pause,
  SkipBack,
  SkipForward,
  Repeat,
  Shuffle,
  Compass,
  Map,
  MapPin,
  Globe,
  GlobeLock,
  Shield,
  ShieldCheck,
  ShieldAlert,
  Key,
  KeyRound,
  Scan,
  QrCode,
  Clipboard,
  ClipboardCheck,
  Scissors,
  Ruler,
  Paintbrush,
  Palette,
  Brush,
  Pen,
  Highlighter,
  Eraser,
  AArrowDown,
  AArrowUp,
  ALargeSmall,
  Accessibility,
  ActivitySquare,
  AirVent,
  Airplay,
  AlarmCheck,
  AlarmClock,
  AlarmClockCheck,
  AlarmClockMinus,
  AlarmClockOff,
  AlarmClockPlus,
  AlarmMinus,
  AlarmPlus,
  AlarmSmoke,
  Album,
  AlertOctagon,
  AlertTriangle,
  AlignCenter,
  AlignCenterHorizontal,
  AlignCenterVertical,
  AlignEndHorizontal,
  AlignEndVertical,
  AlignHorizontalDistributeCenter,
  AlignHorizontalDistributeEnd,
  AlignHorizontalDistributeStart,
  AlignHorizontalJustifyCenter,
  AlignHorizontalJustifyEnd,
  AlignHorizontalJustifyStart,
  AlignHorizontalSpaceAround,
  AlignHorizontalSpaceBetween,
  AlignJustify,
  AlignLeft,
  AlignRight,
  AlignStartHorizontal,
  AlignStartVertical,
  AlignVerticalDistributeCenter,
  AlignVerticalDistributeEnd,
  AlignVerticalDistributeStart,
  AlignVerticalJustifyCenter,
  AlignVerticalJustifyEnd,
  AlignVerticalJustifyStart,
  AlignVerticalSpaceAround,
  AlignVerticalSpaceBetween,
  Ambulance,
  Ampersand,
  Ampersands,
  Amphora,
  Anchor,
  Angry,
  Annoyed,
  Antenna,
  Anvil,
  Aperture,
  AppWindow,
  AppWindowMac,
  Apple,
  Archive,
  ArchiveRestore,
  ArchiveX,
  AreaChart,
  Armchair,
  ArrowBigDown,
  ArrowBigDownDash,
  ArrowBigLeft,
  ArrowBigLeftDash,
  ArrowBigRight,
  ArrowBigRightDash,
  ArrowBigUp,
  ArrowBigUpDash,
  ArrowDown01,
  ArrowDown10,
  ArrowDownAZ,
  ArrowDownAz,
  ArrowDownCircle,
  ArrowDownFromLine,
  ArrowDownLeft,
  ArrowDownLeftFromCircle,
  ArrowDownLeftFromSquare,
  ArrowDownLeftSquare,
  ArrowDownNarrowWide,
  ArrowDownRightFromCircle,
  ArrowDownRightFromSquare,
  ArrowDownRightSquare,
  ArrowDownSquare,
  ArrowDownToDot,
  ArrowDownToLine,
  ArrowDownUp,
  ArrowDownWideNarrow,
  ArrowDownZA,
  ArrowDownZa,
  ArrowLeftCircle,
  ArrowLeftFromLine,
  ArrowLeftRight,
  ArrowLeftSquare,
  ArrowLeftToLine,
  ArrowRightCircle,
  ArrowRightFromLine,
  ArrowRightLeft,
  ArrowRightSquare,
  ArrowRightToLine,
  ArrowUp01,
  ArrowUp10,
  ArrowUpAZ,
  ArrowUpAz,
  ArrowUpCircle,
  ArrowUpDown,
  ArrowUpFromDot,
  ArrowUpFromLine,
  ArrowUpLeft,
  ArrowUpLeftFromCircle,
  ArrowUpLeftFromSquare,
  ArrowUpLeftSquare,
  ArrowUpNarrowWide,
  ArrowUpRightFromCircle,
  ArrowUpRightFromSquare,
  ArrowUpRightSquare,
  ArrowUpSquare,
  ArrowUpToLine,
  ArrowUpWideNarrow,
  ArrowUpZA,
  ArrowUpZa,
  ArrowsUpFromLine,
  Asterisk,
  AsteriskSquare,
  Atom,
  AudioLines,
  AudioWaveform,
  Axe,
  Axis3D,
  Baby,
  Backpack,
  Badge,
  BadgeAlert,
  BadgeCent,
  BadgeCheck,
  BadgeDollarSign,
  BadgeEuro,
  BadgeHelp,
  BadgeIndianRupee,
  BadgeInfo,
  Receipt,
  ReceiptText,
  BanknoteArrowDown,
  BanknoteArrowUp,
  CandlestickChart,
  ChartArea,
  ChartBar,
  ChartBarIncreasing,
  ChartBarDecreasing,
  TrendingDown,
  Euro,
  PoundSterling,
  JapaneseYen,
  RussianRuble,
  SwissFranc,
  TurkishLira,
  IndianRupee,
  PhilippinePeso,
  CircleDollarSign,
  HandCoins,
  Wallet2,
  WalletCards,
  HouseHeart,
  Flower2,
  Flower,
  Sprout,
  Trees,
  TreePine,
  TreePalm,
  Palmtree,
  Hospital,
  Bed,
  BedDouble,
  Utensils,
  UtensilsCrossed,
  Coffee,
  Wine,
  WineOff,
  Beer,
  Cake,
  CakeSlice,
  Egg,
  EggFried,
  Carrot,
  Salad,
  Soup,
  Milk,
  Pizza,
  BottleWine,
  Bird,
  Cat,
  Dog,
  Fish,
  FishOff,
  Bug,
  PawPrint,
  Rabbit,
  Snail,
  Squirrel,
  Turtle,
  Worm,
  Beef,
  Bone,
  Feather,
  Microchip,
  Code2,
  CodeSquare,
  Terminal,
  TerminalSquare,
  DatabaseBackup,
  ServerCog,
  ServerOff,
  CloudCheck,
  WifiCog,
  BluetoothConnected,
  BluetoothOff,
  Usb,
  MonitorCheck,
  Laptop2,
  SmartphoneCharging,
  Cable,
  Plug,
  PlugZap,
  CircuitBoard,
  Binary,
  Bot,
  ScanBarcode,
  ScanText,
  Radar,
  Satellite,
  SatelliteDish,
  Microscope,
  Dumbbell,
  Footprints,
  Timer,
  TimerOff,
  TimerReset,
  Volleyball,
};

/** Sorted list of available icon names for pickers */
export const AVAILABLE_ICONS = Object.keys(ICON_MAP).sort();

/** Category definitions: [label, ...keywords]. Icon matches first category whose keyword is in the name. */
const CATEGORY_RULES: Array<{ id: string; label: string; keywords: string[] }> = [
  { id: 'financial', label: 'Financial & Money', keywords: ['Chart', 'Banknote', 'Dollar', 'Euro', 'Pound', 'Yen', 'Ruble', 'Franc', 'Lira', 'Rupee', 'Peso', 'Receipt', 'Wallet', 'Coins', 'CreditCard', 'Candlestick', 'Trending', 'Landmark', 'Scale', 'PiggyBank', 'HandCoins', 'CircleDollarSign'] },
  { id: 'life', label: 'Life & Home', keywords: ['Heart', 'Flower', 'Tree', 'Leaf', 'Sprout', 'House', 'Home', 'Baby', 'Hospital', 'Bed', 'Utensils', 'Coffee', 'Wine', 'Beer', 'Cake', 'Egg', 'Apple', 'Carrot', 'Salad', 'Soup', 'Milk', 'Pizza', 'Palmtree', 'BottleWine'] },
  { id: 'animal', label: 'Animals', keywords: ['Bird', 'Cat', 'Dog', 'Fish', 'Bug', 'Paw', 'Rabbit', 'Snail', 'Squirrel', 'Turtle', 'Worm', 'Beef', 'Bone', 'Feather'] },
  { id: 'technology', label: 'Technology', keywords: ['Cpu', 'Microchip', 'Code', 'Terminal', 'Database', 'Server', 'Cloud', 'Wifi', 'Bluetooth', 'Usb', 'Monitor', 'Laptop', 'Smartphone', 'Tablet', 'Cable', 'Plug', 'Circuit', 'Binary', 'Bot', 'Scan', 'Radar', 'Satellite', 'Microscope', 'QrCode', 'HardDrive'] },
  { id: 'sport', label: 'Sport & Activity', keywords: ['Trophy', 'Medal', 'Award', 'Target', 'Dumbbell', 'Bike', 'Footprints', 'Timer', 'Volleyball', 'Activity'] },
  { id: 'communication', label: 'Communication & People', keywords: ['Mail', 'Message', 'Phone', 'Send', 'Share', 'User', 'AtSign', 'Contact', 'Voicemail'] },
  { id: 'documents', label: 'Documents & Files', keywords: ['File', 'Folder', 'Clipboard', 'Book', 'Archive', 'Document'] },
  { id: 'media', label: 'Media & Entertainment', keywords: ['Music', 'Video', 'Camera', 'Image', 'Mic', 'Headphone', 'Play', 'Pause', 'Film', 'Disc', 'Volume'] },
  { id: 'navigation', label: 'Navigation & Travel', keywords: ['Compass', 'MapPin', 'Globe', 'Plane', 'Car', 'Ship', 'Bus', 'Truck', 'Train', 'Anchor', 'Route'] },
  { id: 'weather', label: 'Weather & Nature', keywords: ['Sun', 'Moon', 'Cloud', 'Snowflake', 'Wind', 'Droplet', 'Flame', 'Thermometer', 'Rain', 'Sunrise', 'Sunset'] },
  { id: 'security', label: 'Security & Privacy', keywords: ['Lock', 'Unlock', 'Shield', 'Key', 'Eye', 'Fingerprint'] },
  { id: 'actions', label: 'Actions & Tools', keywords: ['Pencil', 'Trash', 'Copy', 'Settings', 'Search', 'Filter', 'Edit', 'Plus', 'Minus', 'Refresh', 'Download', 'Upload'] },
  { id: 'shopping', label: 'Shopping & Commerce', keywords: ['ShoppingCart', 'ShoppingBag', 'Package', 'Gift', 'Tag'] },
  { id: 'status', label: 'Status & Alerts', keywords: ['CheckCircle', 'XCircle', 'AlertCircle', 'Info', 'HelpCircle', 'Bell', 'Flag', 'Bookmark', 'Star'] },
];

export function getIconCategory(name: string): string {
  for (const cat of CATEGORY_RULES) {
    if (cat.keywords.some((kw) => name.includes(kw))) return cat.id;
  }
  return 'general';
}

/** Icons grouped by category for picker UI. Excludes alignment icons. */
export const ICONS_BY_CATEGORY = (() => {
  const exclude = (n: string) => n.startsWith('Align');
  const icons = AVAILABLE_ICONS.filter((n) => !exclude(n));
  const groups: Array<{ id: string; label: string; icons: string[] }> = [];
  const byCat: Record<string, string[]> = {};
  for (const name of icons) {
    const cat = getIconCategory(name);
    if (!byCat[cat]) byCat[cat] = [];
    byCat[cat].push(name);
  }
  for (const { id, label } of CATEGORY_RULES) {
    const list = byCat[id];
    if (list?.length) groups.push({ id, label, icons: list });
  }
  const general = byCat['general'];
  if (general?.length) groups.push({ id: 'general', label: 'General', icons: general });
  return groups;
})();

export function getIconComponent(name: string | undefined): LucideIcon | null {
  if (!name || typeof name !== 'string') return null;
  const trimmed = name.trim();
  if (!trimmed) return null;
  return ICON_MAP[trimmed] ?? null;
}
